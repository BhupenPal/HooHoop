/*
Copyright (c) 2017 NAVER Corp.
@egjs/view360 project is licensed under the MIT license
@egjs/view360 JavaScript library
https://github.com/naver/egjs-view360
@version 3.3.0-snapshot
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@egjs/axes"),require("@egjs/component")):"function"==typeof define&&define.amd?define(["exports","@egjs/axes","@egjs/component"],e):e((t.eg=t.eg||{},t.eg.view360={}),t.eg.Axes,t.eg.Component)}(this,(function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var h=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function(){function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,i=void 0,r=void 0,o=function(t,e){f[n]=t,f[n+1]=e,2===(n+=2)&&(r?r(_):E())},a="undefined"!=typeof window?window:void 0,s=a||{},h=s.MutationObserver||s.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var t=setTimeout;return function(){return t(_,1)}}var f=new Array(1e3);function _(){for(var t=0;t<n;t+=2)(0,f[t])(f[t+1]),f[t]=void 0,f[t+1]=void 0;n=0}var v,g,p,m,E=void 0;function y(t,e){var n=this,i=new this.constructor(x);void 0===i[R]&&V(i);var r=n._state;if(r){var a=arguments[r-1];o((function(){return L(r,i,a,n._result)}))}else D(n,i,t,e);return i}function w(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(x);return I(e,t),e}c?E=function(){return process.nextTick(_)}:h?(g=0,p=new h(_),m=document.createTextNode(""),p.observe(m,{characterData:!0}),E=function(){m.data=g=++g%2}):l?((v=new MessageChannel).port1.onmessage=_,E=function(){return v.port2.postMessage(0)}):E=void 0===a?function(){try{var t=Function("return this")().require("vertx");return void 0!==(i=t.runOnLoop||t.runOnContext)?function(){i(_)}:d()}catch(t){return d()}}():d();var R=Math.random().toString(36).substring(2);function x(){}var T=void 0,C=1,A=2;function b(e,n,i){n.constructor===e.constructor&&i===y&&n.constructor.resolve===w?function(t,e){e._state===C?P(t,e._result):e._state===A?O(t,e._result):D(e,void 0,(function(e){return I(t,e)}),(function(e){return O(t,e)}))}(e,n):void 0===i?P(e,n):t(i)?function(t,e,n){o((function(t){var i=!1,r=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(n,e,(function(n){i||(i=!0,e!==n?I(t,n):P(t,n))}),(function(e){i||(i=!0,O(t,e))}),t._label);!i&&r&&(i=!0,O(t,r))}),t)}(e,n,i):P(e,n)}function I(t,e){if(t===e)O(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var n=void 0;try{n=e.then}catch(e){return void O(t,e)}b(t,e,n)}else P(t,e)}function S(t){t._onerror&&t._onerror(t._result),M(t)}function P(t,e){t._state===T&&(t._result=e,t._state=C,0!==t._subscribers.length&&o(M,t))}function O(t,e){t._state===T&&(t._state=A,t._result=e,o(S,t))}function D(t,e,n,i){var r=t._subscribers,a=r.length;t._onerror=null,r[a]=e,r[a+C]=n,r[a+A]=i,0===a&&t._state&&o(M,t)}function M(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,o=t._result,a=0;a<e.length;a+=3)i=e[a],r=e[a+n],i?L(n,i,r,o):r(o);t._subscribers.length=0}}function L(e,n,i,r){var o=t(i),a=void 0,s=void 0,u=!0;if(o){try{a=i(r)}catch(t){u=!1,s=t}if(n===a)return void O(n,new TypeError("A promises callback cannot return that same promise."))}else a=r;n._state!==T||(o&&u?I(n,a):!1===u?O(n,s):e===C?P(n,a):e===A&&O(n,a))}var N=0;function V(t){t[R]=N++,t._state=void 0,t._result=void 0,t._subscribers=[]}var U=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(x),this.promise[R]||V(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&P(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===T&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===w){var r=void 0,o=void 0,a=!1;try{r=t.then}catch(t){a=!0,o=t}if(r===y&&t._state!==T)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===F){var s=new n(x);a?O(s,o):b(s,t,r),this._willSettleAt(s,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(i(t),e)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===T&&(this._remaining--,t===A?O(i,n):this._result[e]=n),0===this._remaining&&P(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;D(t,void 0,(function(t){return n._settledAt(C,e,t)}),(function(t){return n._settledAt(A,e,t)}))},t}(),F=function(){function e(t){this[R]=N++,this._result=this._state=void 0,this._subscribers=[],x!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){I(t,e)}),(function(e){O(t,e)}))}catch(e){O(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return F.prototype.then=y,F.all=function(t){return new U(this,t).promise},F.race=function(t){var n=this;return e(t)?new n((function(e,i){for(var r=t.length,o=0;o<r;o++)n.resolve(t[o]).then(e,i)})):new n((function(t,e){return e(new TypeError("You must pass an array to race."))}))},F.resolve=w,F.reject=function(t){var e=new this(x);return O(e,t),e},F._setScheduler=function(t){r=t},F._setAsap=function(t){o=t},F._asap=o,F.polyfill=function(){var t=void 0;if(void 0!==u)t=u;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=F},F.Promise=F,F}()})),c=1e-6,l="undefined"!=typeof Float32Array?Float32Array:Array,d=Math.PI/180;function f(t){return t*d}function _(){var t=new l(9);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function v(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function g(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=c*a-s*h,d=-c*o+s*u,f=h*o-a*u,_=n*l+i*d+r*f;return _?(_=1/_,t[0]=l*_,t[1]=(-c*i+r*h)*_,t[2]=(s*i-r*a)*_,t[3]=d*_,t[4]=(c*n-r*u)*_,t[5]=(-s*n+r*o)*_,t[6]=f*_,t[7]=(-h*n+i*u)*_,t[8]=(a*n-i*o)*_,t):null}function p(){var t=new l(16);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function m(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*i,t[5]=a*r+c*i,t[6]=s*r+l*i,t[7]=u*r+d*i,t[8]=h*r-o*i,t[9]=c*r-a*i,t[10]=l*r-s*i,t[11]=d*r-u*i,t}function E(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-h*i,t[1]=a*r-c*i,t[2]=s*r-l*i,t[3]=u*r-d*i,t[8]=o*i+h*r,t[9]=a*i+c*r,t[10]=s*i+l*r,t[11]=u*i+d*r,t}function y(t,e,n,i,r){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}function w(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function R(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function x(t,e,n){var i=new l(3);return i[0]=t,i[1]=e,i[2]=n,i}function T(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function C(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function A(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function b(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=r*u-o*s,t[1]=o*a-i*u,t[2]=i*s-r*a,t}function I(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t}function S(t,e,n){var i=n[0],r=n[1],o=n[2],a=n[3],s=e[0],u=e[1],h=e[2],c=r*h-o*u,l=o*s-i*h,d=i*u-r*s,f=r*d-o*l,_=o*c-i*d,v=i*l-r*c,g=2*a;return c*=g,l*=g,d*=g,f*=2,_*=2,v*=2,t[0]=s+c+f,t[1]=u+l+_,t[2]=h+d+v,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var P,O=T,D=R;P=w();!function(){var t,e=(t=new l(4),l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function M(){var t=new l(4);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function L(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function N(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],u=n[1],h=n[2],c=n[3];return t[0]=i*c+a*s+r*h-o*u,t[1]=r*c+a*u+o*s-i*h,t[2]=o*c+a*h+i*u-r*s,t[3]=a*c-i*s-r*u-o*h,t}function V(t,e,n,i){var r,o,a,s,u,h=e[0],l=e[1],d=e[2],f=e[3],_=n[0],v=n[1],g=n[2],p=n[3];return(o=h*_+l*v+d*g+f*p)<0&&(o=-o,_=-_,v=-v,g=-g,p=-p),1-o>c?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-i)*r)/a,u=Math.sin(i*r)/a):(s=1-i,u=i),t[0]=s*h+u*_,t[1]=s*l+u*v,t[2]=s*d+u*g,t[3]=s*f+u*p,t}function U(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var F,B,W,X,Y,H,G=function(t){var e=new l(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},k=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},j=N,q=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=i*a,t[2]=r*a,t[3]=o*a,t},z=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]};F=w(),B=x(1,0,0),W=x(0,1,0),X=M(),Y=M(),H=_();function Q(t,e){var n=new l(2);return n[0]=t,n[1]=e,n}function K(t,e){return t[0]=e[0],t[1]=e[1],t}function Z(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t}!function(){var t,e=(t=new l(2),l!=Float32Array&&(t[0]=0,t[1]=0),t)}();var J="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),$=J.document,tt=J.navigator&&J.navigator.userAgent||"",et=navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),nt=-1!==tt.indexOf("Safari")&&-1===tt.indexOf("Chrome")&&-1!==tt.indexOf("Mac OS X")&&!et;/SamsungBrowser/i.test(tt);J.Float32Array=void 0!==J.Float32Array?J.Float32Array:J.Array;J.Float32Array;var it=J.getComputedStyle,rt=J.navigator.userAgent,ot="ontouchstart"in J,at="ondevicemotion"in J,st=J.DeviceMotionEvent,ut=J.devicePixelRatio,ht=function(){for(var t=$.documentElement.style,e=["transform","webkitTransform","msTransform","mozTransform"],n=0,i=e.length;n<i;n++)if(e[n]in t)return e[n];return""}(),ct=J.CSS&&J.CSS.supports&&J.CSS.supports("will-change","transform"),lt=!1,dt=function(){navigator.xr&&(navigator.xr.isSessionSupported?navigator.xr.isSessionSupported("immersive-vr").then((function(t){lt=t})).catch((function(){})):navigator.xr.supportsSession&&navigator.xr.supportsSession("immersive-vr").then((function(t){lt=t})).catch((function(){})))};function ft(t){return 180*t/Math.PI}var _t={isPowerOfTwo:function(t){return t&&0==(t&t-1)}};_t.extractPitchFromQuat=function(t){var e=function(t){var e=x(0,0,1);return S(e,e,t),e}(t);return-1*Math.atan2(e[1],Math.sqrt(Math.pow(e[0],2)+Math.pow(e[2],2)))},_t.hypot=Math.hypot||function(t,e){return Math.sqrt(t*t+e*e)};var vt={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};function gt(t,e){var n=t[0]*e[1]-e[0]*t[1];return-Math.atan2(n,function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e))}vt[vt.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},vt[vt.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},vt[vt.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]},_t.yawOffsetBetween=function(t,e){var n=Q(t[0],t[2]),i=Q(e[0],e[2]);return Z(n,n),Z(i,i),-gt(n,i)},_t.toDegree=ft,_t.getRotationDelta=function(t,e,n){var i=x(vt[n].targetAxis[0],vt[n].targetAxis[1],vt[n].targetAxis[2]),r=vt[n].meshPoint,o=G(t),a=G(e);q(o,o),q(a,a);var s=x(0,0,1),u=x(0,0,1);S(s,s,o),S(u,u,a),S(i,i,a);var h,c=A(i,b(w(),s,u))>0?1:-1,l=x(r[0],r[1],r[2]);h=n!==vt.YAW_DELTA_BY_YAW?x(0,c,0):x(c,0,0),S(l,l,a),S(h,h,a);var d=l,f=h,_=w();b(_,d,f),C(_,_);var v=_[0],g=_[1],p=_[2];S(u=x(r[0],r[1],r[2]),u,a),S(s=x(r[0],r[1],r[2]),s,o);var m=Math.abs(s[0]*v+s[1]*g+s[2]*p),E=w();T(E,s,function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}(w(),_,m));var y=(E[0]*u[0]+E[1]*u[1]+E[2]*u[2])/(R(E)*R(u));y>1&&(y=1);var I=Math.acos(y),P=b(w(),u,E);return m=v*P[0]+g*P[1]+p*P[2],ft(I*(n!==vt.YAW_DELTA_BY_YAW?m>0?1:-1:m<0?1:-1)*c)},_t.angleBetweenVec2=gt;var pt=function(t){function n(n,i,r){var o;return(o=t.call(this,n,i)||this)._useRotation=!1,o._deviceSensor=r,o.setUseRotation(!(!i||!i.useRotation)),o._userDirection=e.DIRECTION_ALL,o}a(n,t);var i=n.prototype;return i.setUseRotation=function(t){this._useRotation=t},i.connect=function(n){this._userDirection=this._direction,this._useRotation&&this._direction&e.DIRECTION_ALL&&(this._direction=e.DIRECTION_HORIZONTAL),t.prototype.connect.call(this,n)},i.getOffset=function(n,i){if(!1===this._useRotation)return t.prototype.getOffset.call(this,n,i);var r=t.prototype.getOffset.call(this,n,[!0,!0]),o=[0,0],a=this._deviceSensor.getDeviceHorizontalRight(),s=Q(a[0],a[1]),u=Q(1,0),h=_t.angleBetweenVec2(s,u),c=Math.cos(h),l=Math.sin(h);return o[0]=r[0]*c-r[1]*l,o[1]=r[1]*c+r[0]*l,this._userDirection&e.DIRECTION_HORIZONTAL?this._userDirection&e.DIRECTION_VERTICAL||(o[1]=0):o[0]=0,o},i.destroy=function(){t.prototype.destroy.call(this)},n}(e.PanInput);const mt=Symbol("__sensor__"),Et=mt;function yt(t,e){for(const n in e)Object.defineProperty(t,n,{configurable:!0,value:e[n]})}const wt=(t,...e)=>(class extends t{constructor(...t){super(t);const e=document.createDocumentFragment();this.addEventListener=(t,...n)=>e.addEventListener(t,...n),this.removeEventListener=(...t)=>e.removeEventListener(...t),this.dispatchEvent=t=>{yt(t,{currentTarget:this}),t.target||yt(t,{target:this});const n=`on${t.type}`;"function"==typeof this[n]&&this[n](t);const i=e.dispatchEvent(t);return i&&this.parentNode&&this.parentNode.dispatchEvent(t),yt(t,{currentTarget:null,target:null}),i}}});class Rt extends(wt(Object)){}function xt(t,e,n){const i=t[e];for(const e in n)i[e]=n[e],Object.defineProperty(t,e,{get:()=>i[e]})}class Tt extends Event{constructor(t,e){if(super(t,e),!(e&&e.error instanceof DOMException))throw TypeError("Failed to construct 'SensorErrorEvent':2nd argument much contain 'error' property");Object.defineProperty(this,"error",{configurable:!1,writable:!1,value:e.error})}}function Ct(t,e){Object.defineProperty(t,`on${e}`,{enumerable:!0,configurable:!1,writable:!0,value:null})}const At={IDLE:1,ACTIVATING:2,ACTIVE:3};class bt extends Rt{constructor(t){if(super(),this[Et]=new WeakMap,Ct(this,"reading"),Ct(this,"activate"),Ct(this,"error"),xt(this,Et,{activated:!1,hasReading:!1,timestamp:null}),this[Et].state=At.IDLE,this[Et].notifyError=(t,e)=>{let n=new Tt("error",{error:new DOMException(t,e)});this.dispatchEvent(n),this.stop()},this[Et].notifyActivatedState=()=>{let t=new Event("activate");this[Et].activated=!0,this.dispatchEvent(t),this[Et].state=At.ACTIVE},this[Et].activateCallback=()=>{},this[Et].deactivateCallback=()=>{},this[Et].frequency=null,window&&window.parent!=window.top)throw new DOMException("Only instantiable in a top-level browsing context","SecurityError");t&&"number"==typeof t.frequency&&t.frequency>60&&(this.frequency=t.frequency)}start(){this[Et].state!==At.ACTIVATING&&this[Et].state!==At.ACTIVE&&(this[Et].state=At.ACTIVATING,this[Et].activateCallback())}stop(){this[Et].state!==At.IDLE&&(this[Et].activated=!1,this[Et].hasReading=!1,this[Et].timestamp=null,this[Et].deactivateCallback(),this[Et].state=At.IDLE)}}const It=mt;let St;screen.orientation?St=screen.orientation:screen.msOrientation?St=screen.msOrientation:(St={},Object.defineProperty(St,"angle",{get:()=>window.orientation||0}));const Pt=(t,...e)=>(class extends t{constructor(...t){super(t);for(const t of e)if(`on${t}`in window){this[It].eventName=t;break}this[It].activateCallback=()=>{window.addEventListener(this[It].eventName,this[It].handleEvent,{capture:!0})},this[It].deactivateCallback=()=>{window.removeEventListener(this[It].eventName,this[It].handleEvent,{capture:!0})}}});function Ot(t,e,n){const i=Math.PI/180,r=(e||0)*i,o=(n||0)*i,a=(t||0)*i,s=Math.cos(.5*a),u=Math.sin(.5*a),h=Math.cos(.5*o),c=Math.sin(.5*o),l=Math.cos(.5*r),d=Math.sin(.5*r);return[d*h*s-l*c*u,l*c*s+d*h*u,l*h*u+d*c*s,l*h*s-d*c*u]}function Dt(t,e){return(t instanceof Float32Array||t instanceof Float64Array)&&t.length>=16&&(t[0]=1-2*(e[1]**2+e[2]**2),t[1]=2*(e[0]*e[1]-e[2]*e[3]),t[2]=2*(e[0]*e[2]+e[1]*e[3]),t[3]=0,t[4]=2*(e[0]*e[1]+e[2]*e[3]),t[5]=1-2*(e[0]**2+e[2]**2),t[6]=2*(e[1]*e[2]-e[0]*e[3]),t[7]=0,t[8]=2*(e[0]*e[2]-e[1]*e[3]),t[9]=2*(e[1]*e[2]+e[0]*e[3]),t[10]=1-2*(e[0]**2+e[1]**2),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1),t}function Mt(t){return t?function(t,e,n){const i=Math.sin(n/2),r=Math.cos(n/2);return function(t){const e=Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2);return 0===e?[0,0,0,1]:t.map(t=>t/e)}(function(t,e){return[t[0]*e[3]+t[3]*e[0]+t[1]*e[2]-t[2]*e[1],t[1]*e[3]+t[3]*e[1]+t[2]*e[0]-t[0]*e[2],t[2]*e[3]+t[3]*e[2]+t[0]*e[1]-t[1]*e[0],t[3]*e[3]-t[0]*e[0]-t[1]*e[1]-t[2]*e[2]]}(t,[e[0]*i,e[1]*i,e[2]*i,r]))}(t,[0,0,1],-St.angle*Math.PI/180):null}const Lt=window.RelativeOrientationSensor||class extends(Pt(bt,"deviceorientation")){constructor(t={}){switch(super(t),t.coordinateSystem||"world"){case"screen":Object.defineProperty(this,"quaternion",{get:()=>Mt(this[It].quaternion)});break;case"world":default:Object.defineProperty(this,"quaternion",{get:()=>this[It].quaternion})}this[It].handleEvent=t=>{t.absolute||null===t.alpha?this[It].notifyError("Could not connect to a sensor","NotReadableError"):(this[It].activated||this[It].notifyActivatedState(),this[It].timestamp=performance.now(),this[It].quaternion=Ot(t.alpha,t.beta,t.gamma),this[It].hasReading=!0,this.dispatchEvent(new Event("reading")))},this[It].deactivateCallback=()=>{this[It].quaternion=null}}populateMatrix(t){Dt(t,this.quaternion)}};window.AbsoluteOrientationSensor||Pt(bt,"deviceorientationabsolute","deviceorientation"),window.Gyroscope||Pt(bt,"devicemotion"),window.Accelerometer||Pt(bt,"devicemotion"),window.LinearAccelerationSensor||Pt(bt,"devicemotion"),window.GravitySensor||Pt(bt,"devicemotion");function Nt(t,e){return _t.getRotationDelta(t,e,vt.PITCH_DELTA)}var Vt=/Chrome\/([0-9]+)\.(?:[0-9]*)\.([0-9]*)\.([0-9]*)/i.exec(rt);Vt&&(parseInt(Vt[1],10),Vt[2],Vt[3]);/Android/i.test(rt);var Ut=6,Ft=[.2,.2],Bt={NONE:"none",YAWPITCH:"yawPitch",VR:"VR"},Wt="undefined"==typeof Promise?h.Promise:Promise,Xt=x(1,0,0),Yt=x(0,1,0),Ht=L(M(),Xt,-Math.PI/2),Gt=function(){return function(t){function e(e){var n;return(n=t.call(this)||this)._onFirstRead=function(){var t=n._sensor,e=n._getOrientation(),i=x(0,0,-1),r=S(w(),i,e),o=_t.yawOffsetBetween(r,i);if(0!==o){var a=L(M(),Yt,-o);j(Ht,a,Ht),n._calibrated=!0,t.removeEventListener("reading",n._onFirstRead),t.addEventListener("reading",n._onSensorRead)}},n._onSensorRead=function(){if(n._observer&&n._gyroMode===Bt.YAWPITCH){var t=n.getYawPitchDelta();n._observer.change(s(n),{},{yaw:t.yaw,pitch:t.pitch})}n.trigger("change",{isTrusted:!0})},n._enabled=!1,n._calibrated=!1,n._sensor=new Lt({frequency:60,coordinateSystem:"screen",referenceFrame:"screen"}),n._prevQuaternion=null,n._gyroMode=e,n._observer=null,n.axes=null,n}a(e,t);var n=e.prototype;return n.mapAxes=function(t){this.axes=t},n.connect=function(t){return this._observer?this:(this._observer=t,this)},n.disconnect=function(){return this._observer?(this._observer=null,this):this},n.setGyroMode=function(t){this._gyroMode=t},n.enable=function(){var t=this;return this._enabled?Wt.resolve("Sensor already enabled"):navigator&&navigator.permissions?Wt.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"gyroscope"})]).then((function(e){e.every((function(t){return"granted"===t.state}))&&t._startSensor()})).catch((function(){t._startSensor()})):(this._startSensor(),Wt.resolve())},n.disable=function(){this._enabled&&(this._prevQuaternion=null,this._sensor.removeEventListener("read",this._onSensorRead),this._sensor.stop())},n.isEnabled=function(){return this._enabled},n.getYawPitchDelta=function(){var t=this._prevQuaternion,e=this._getOrientation();if(!t)return this._prevQuaternion=e,{yaw:0,pitch:0};var n,i,r,o={yaw:(n=t,i=e,r=_t.getRotationDelta(n,i,vt.YAW_DELTA_BY_YAW),_t.getRotationDelta(n,i,vt.YAW_DELTA_BY_ROLL)*Math.sin(_t.extractPitchFromQuat(i))+r),pitch:Nt(t,e)};return k(t,e),o},n.getCombinedQuaternion=function(t){var e=this._getOrientation();this._prevQuaternion||(this._prevQuaternion=k(M(),e));var n=L(M(),Yt,f(t)),i=N(M(),n,e);return U(i,i),k(this._prevQuaternion,e),i},n.getDeviceHorizontalRight=function(t){var e=t||this._getOrientation(),n=U(M(),e),i=x(0,0,-1),r=S(w(),i,e),o=b(w(),r,Yt),a=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}(w(),r,o),s=w();return S(s,a,n),O(s,s,i),s[2]=0,C(s,s),s},n.destroy=function(){this.disable()},n._getOrientation=function(){return this._sensor.quaternion?N(M(),Ht,this._sensor.quaternion):M()},n._startSensor=function(){var t=this._sensor;t.start(),this._calibrated?t.addEventListener("reading",this._onSensorRead):t.addEventListener("reading",this._onFirstRead),this._enabled=!0},e}(n)}(),kt="3.3.0-snapshot",jt="undefined"==typeof Promise?h.Promise:Promise,qt=[-180,180],zt=[-90,90],Qt=[-180,180],Kt=function(){var t=function(t){function n(e){var n;n=t.call(this)||this;var i=o({element:null,yaw:0,pitch:0,fov:65,showPolePoint:!1,useZoom:!0,useKeyboard:!0,gyroMode:Bt.YAWPITCH,touchDirection:Ut,yawRange:qt,pitchRange:zt,fovRange:[30,110],aspectRatio:1},e);return n._element=i.element,n._initialFov=i.fov,n._enabled=!1,n._isAnimating=!1,n._deviceSensor=(new Gt).on("change",(function(t){n._triggerChange(t)})),n._initAxes(i),n.option(i),n}a(n,t);var i=n.prototype;return i._initAxes=function(t){var i=this,r=this._updateYawRange(t.yawRange,t.fov,t.aspectRatio),o=this._updatePitchRange(t.pitchRange,t.fov,t.showPolePoint),a=t.gyroMode===Bt.VR;this.axesPanInput=new pt(this._element,{useRotation:a},this._deviceSensor),this.axesWheelInput=new e.WheelInput(this._element,{scale:-4}),this.axesPinchInput=ot?new e.PinchInput(this._element,{scale:-1}):null,this.axesMoveKeyInput=new e.MoveKeyInput(this._element,{scale:[-6,6]}),this.axes=new e({yaw:{range:r,circular:n.isCircular(r),bounce:[0,0]},pitch:{range:o,circular:n.isCircular(o),bounce:[0,0]},fov:{range:t.fovRange,circular:[!1,!1],bounce:[0,0]}},{deceleration:.0014,maximumDuration:1e3},{yaw:t.yaw,pitch:t.pitch,fov:t.fov}).on({hold:function(t){i.axes.options.maximumDuration=1e3,i.trigger("hold",{isTrusted:t.isTrusted})},change:function(t){0!==t.delta.fov&&(i._updateControlScale(t),i.updatePanScale()),i._triggerChange(t)},release:function(t){i._triggerChange(t)},animationStart:function(t){},animationEnd:function(t){i.trigger("animationEnd",{isTrusted:t.isTrusted})}})},i.updatePanScale=function(t){void 0===t&&(t={});var e=this.axes.get().fov,n=t.height||parseInt(it(this._element).height,10),i=Ft[0]*e/this._initialFov*320/n;return this.axesPanInput.options.scale=[i,i],this.axes.options.deceleration=.0014*e/110,this},i.option=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.length;if(0===i)return this._getOptions();if(1===i&&"string"==typeof e[0])return this._getOptions(e[0]);var r=o({},this.options),a={},s=[];return 1===i?(s=Object.keys(e[0]),a=o({},e[0])):i>=2&&(s.push(e[0]),a[e[0]]=e[1]),this._setOptions(this._getValidatedOptions(a)),this._applyOptions(s,r),this},i._getValidatedOptions=function(t){return t.yawRange&&(t.yawRange=this._getValidYawRange(t.yawRange,t.fov,t.aspectRatio)),t.pitchRange&&(t.pitchRange=this._getValidPitchRange(t.pitchRange,t.fov)),t},i._getOptions=function(t){var e;return"string"==typeof t?e=this.options[t]:0===arguments.length&&(e=this.options),e},i._setOptions=function(t){for(var e in t)this.options[e]=t[e]},i._applyOptions=function(t,e){var n=this.options,i=this.axes,r=n.gyroMode===Bt.VR,o=n.gyroMode===Bt.YAWPITCH,a=r?2&n.touchDirection:n.touchDirection;if(t.some((function(t){return"showPolePoint"===t||"fov"===t||"aspectRatio"===t||"yawRange"===t||"pitchRange"===t}))&&(t.indexOf("fov")>=0&&(i.setTo({fov:n.fov}),this.updatePanScale()),this._updateControlScale()),t.some((function(t){return"fovRange"===t}))){var s=n.fovRange,u=i.get().fov,h=i.get().fov;K(i.axis.fov.range,s),h<s[0]?h=s[0]:u>s[1]&&(h=s[1]),u!==h&&(i.setTo({fov:h},0),this._updateControlScale(),this.updatePanScale())}(t.some((function(t){return"gyroMode"===t}))&&at&&(r||o?(i.connect(["yaw","pitch"],this._deviceSensor),this._deviceSensor.enable().catch((function(){}))):(i.disconnect(this._deviceSensor),this._deviceSensor.disable()),this._deviceSensor.setGyroMode(n.gyroMode),r&&this.axesPanInput.setUseRotation(r)),t.some((function(t){return"useKeyboard"===t})))&&(n.useKeyboard?i.connect(["yaw","pitch"],this.axesMoveKeyInput):i.disconnect(this.axesMoveKeyInput));if(t.some((function(t){return"useZoom"===t}))){var c=n.useZoom;i.disconnect(this.axesWheelInput),c&&i.connect(["fov"],this.axesWheelInput)}this._togglePinchInputByOption(n.touchDirection,n.useZoom),t.some((function(t){return"touchDirection"===t}))&&this._enabled&&this._enableTouch(a)},i._togglePinchInputByOption=function(t,e){this.axesPinchInput&&(this.axes.disconnect(this.axesPinchInput),e&&t===Ut&&-1===this.axes._inputs.indexOf(this.axesPinchInput)&&this.axes.connect(["fov"],this.axesPinchInput))},i._enableTouch=function(t){this.axesPanInput&&this.axes.disconnect(this.axesPanInput);var e=2&t?"yaw":null,n=4&t?"pitch":null;this.axes.connect([e,n],this.axesPanInput)},i._getValidYawRange=function(t,e,i){var r=n.adjustAspectRatio(i||this.options.aspectRatio||1),o=(e||this.axes.get().fov)*r;return t[1]-t[0]>=o?t:this.options.yawRange||qt},i._getValidPitchRange=function(t,e){var n=e||this.axes.get().fov;return t[1]-t[0]>=n?t:this.options.pitchRange||zt},n.isCircular=function(t){return t[1]-t[0]<360?[!1,!1]:[!0,!0]},i._updateControlScale=function(t){var e=this.options,i=this.axes.get().fov,r=this._updatePitchRange(e.pitchRange,i,e.showPolePoint),o=this._updateYawRange(e.yawRange,i,e.aspectRatio),a=this.axes.get(),s=a.yaw,u=a.pitch;return K(this.axes.axis.yaw.range,o),K(this.axes.axis.pitch.range,r),this.axes.axis.yaw.circular=n.isCircular(o),this.axes.axis.pitch.circular=n.isCircular(r),s<o[0]?s=o[0]:s>o[1]&&(s=o[1]),u<r[0]?u=r[0]:u>r[1]&&(u=r[1]),t&&t.set({yaw:s,pitch:u}),this.axes.setTo({yaw:s,pitch:u},0),this},i._updatePitchRange=function(t,e,n){if(this.options.gyroMode===Bt.VR)return Qt;var i=t[1]-t[0],r=e/2;return n&&!(i<180)?t.concat():[t[0]+r,t[1]-r]},i._updateYawRange=function(t,e,n){if(this.options.gyroMode===Bt.VR)return qt;if(t[1]-t[0]>=360)return t.concat();var i=_t.toDegree(Math.atan2(n,1/Math.tan(f(e/2))));return[t[0]+i,t[1]-i]},i._triggerChange=function(t){var e=this.axes.get(),n=this.options,i={targetElement:n.element,isTrusted:t.isTrusted};i.yaw=e.yaw,i.pitch=e.pitch,i.fov=e.fov,n.gyroMode===Bt.VR&&(i.quaternion=this._deviceSensor.getCombinedQuaternion(e.yaw)),this.trigger("change",i)},n.adjustAspectRatio=function(t){for(var e=[.52,.54,.563,.57,.584,.59,.609,.67,.702,.72,.76,.78,.82,.92,.97,1,1.07,1.14,1.19,1.25,1.32,1.38,1.4,1.43,1.53,1.62,1.76,1.77,1.86,1.96,2.26,2.3,2.6,3,5,6],i=[.51,.54,.606,.56,.628,.63,.647,.71,.736,.757,.78,.77,.8,.89,.975,1,1.07,1.1,1.15,1.18,1.22,1.27,1.3,1.33,1.39,1.45,1.54,1.55,1.58,1.62,1.72,1.82,1.92,2,2.24,2.3],r=-1,o=0;o<e.length-1;o++)if(e[o]<=t&&e[o+1]>=t){r=o;break}if(-1===r)return e[0]>t?i[0]:i[i[0].length-1];var a=e[r],s=e[r+1],u=i[r],h=i[r+1];return n.lerp(u,h,(t-a)/(s-a))},n.lerp=function(t,e,n){return t+n*(e-t)},i.enable=function(){return this._enabled?this:(this._enabled=!0,this._applyOptions(Object.keys(this.options),this.options),this.updatePanScale(),this.enableSensor().catch((function(){})),this)},i.disable=function(t){return this._enabled?(t||this._resetOrientation(),this.axes.disconnect(),this.disableSensor(),this._enabled=!1,this):this},i._resetOrientation=function(){var t=this.options;return this.axes.setTo({yaw:t.yaw,pitch:t.pitch,fov:t.fov},0),this},i.lookAt=function(t,e){var n=t.yaw,i=t.pitch,r=t.fov,o=this.axes.get(),a=void 0===n?0:n-o.yaw,s=void 0===i?0:i-o.pitch,u=void 0===r?0:r-o.fov;this.axes.options.maximumDuration=1/0,this.axes.setBy({yaw:a,pitch:s,fov:u},e)},i.enableSensor=function(){var t=this;return new jt((function(e,n){var i=function(){t.options.gyroMode!==Bt.NONE?(t._deviceSensor.enable(),e()):n(new Error("gyroMode not set"))};DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(t){"granted"===t?i():n(new Error("denied"))})).catch((function(t){n(t)})):i()}))},i.disableSensor=function(){this._deviceSensor.disable()},i.getYawPitch=function(){var t=this.axes.get();return{yaw:t.yaw,pitch:t.pitch}},i.getFov=function(){return this.axes.get().fov},i.getQuaternion=function(){var t=this.axes.get();return this._deviceSensor.getCombinedQuaternion(t.yaw)},i.shouldRenderWithQuaternion=function(){return this.options.gyroMode===Bt.VR},i.destroy=function(){this.axes&&this.axes.destroy(),this.axisPanInput&&this.axisPanInput.destroy(),this.axesWheelInput&&this.axesWheelInput.destroy(),this.axesDeviceOrientationInput&&this.axesDeviceOrientationInput.destroy(),this.axesPinchInput&&this.axesPinchInput.destroy(),this.axesMoveKeyInput&&this.axesMoveKeyInput.destroy(),this._deviceSensor&&this._deviceSensor.destroy()},n}(n);return t.VERSION=kt,t.CONTROL_MODE_VR=1,t.CONTROL_MODE_YAWPITCH=2,t.TOUCH_DIRECTION_ALL=Ut,t.TOUCH_DIRECTION_YAW=2,t.TOUCH_DIRECTION_PITCH=4,t.TOUCH_DIRECTION_NONE=1,t}(),Zt="undefined"==typeof Promise?h.Promise:Promise,Jt={NONE:0,LOADING:1,LOADED:2,ERROR:3},$t="readystatechange",te=function(){var t=function(t){function e(e){var n;return(n=t.call(this)||this)._image=null,n._onceHandlers=[],n._loadStatus=Jt.NONE,e&&n.set(e),n}a(e,t);var n=e.prototype;return n.get=function(){var t=this;return new Zt((function(n,i){t._image?t._loadStatus===Jt.LOADED?n(t.getElement()):t._loadStatus===Jt.LOADING?e.isMaybeLoaded(t._image)?(t._loadStatus=Jt.LOADED,n(t.getElement())):t.on($t,(function(e){e.type===Jt.LOADED?n(t.getElement()):i("ImageLoader: failed to load images.")})):i("ImageLoader: failed to load images"):i("ImageLoader: image is not defiend")}))},n.set=function(t){var n=this;this._loadStatus=Jt.LOADING,this._image=e.createElement(t),e.isMaybeLoaded(this._image)?this._loadStatus=Jt.LOADED:this.onceLoaded(this._image,(function(){n._loadStatus=Jt.LOADED,n.trigger($t,{type:Jt.LOADED})}),(function(){n._loadStatus=Jt.ERROR,n.trigger($t,{type:Jt.ERROR})}))},e.createElement=function(t){return(t instanceof Array?t:[t]).map((function(t){var e=t;return"string"==typeof t&&((e=new Image).crossOrigin="anonymous",e.src=t),e}))},n.getElement=function(){return 1===this._image.length?this._image[0]:this._image},e.isMaybeLoaded=function(t){var e=!1;return t instanceof Image?e=t.complete&&0!==t.naturalWidth:t instanceof Array&&(e=!t.some((function(t){return!t.complete||0===t.naturalWidth}))),e},n.onceLoaded=function(t,n,i){var r=this,o=t instanceof Array?t:[t],a=o.filter((function(t){return!e.isMaybeLoaded(t)})).map((function(t){return new Zt((function(e,n){r._once(t,"load",(function(){return e(t)})),r._once(t,"error",(function(){return n(t)}))}))}));Zt.all(a).then((function(t){return n(1===o.length?o[0]:o)}),(function(t){return i(t)}))},n._once=function(t,e,n){var i=function i(r){t.removeEventListener(e,i),n(r)};t.addEventListener(e,i),this._onceHandlers.push({target:t,type:e,fn:i})},n.getStatus=function(){return this._loadStatus},n.destroy=function(){this._onceHandlers.forEach((function(t){t.target.removeEventListener(t.type,t.fn)})),this._onceHandlers=[],this._image.src="",this._image=null,this._loadStatus=Jt.NONE},e}(n);return t.STATUS=Jt,t}(),ee="undefined"==typeof Promise?h.Promise:Promise,ne={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4,LOADING_FAILED:-1},ie={};ie[ne.HAVE_METADATA]="loadedmetadata",ie[ne.HAVE_CURRENT_DATA]="loadeddata",ie[ne.HAVE_FUTURE_DATA]="canplay",ie[ne.HAVE_ENOUGH_DATA]="canplaythrough";var re=function(){function t(t){this._handlers=[],this._sourceCount=0,this._thresholdReadyState=ne.HAVE_METADATA,this._thresholdEventName=ie[this._thresholdReadyState],this._loadStatus=t&&t.readyState||ne.HAVE_NOTHING,this._onerror=this._onerror.bind(this),t&&this.set(t)}var e=t.prototype;return e._onerror=function(){this._errorCount++,this._errorCount>=this._sourceCount&&(this._loadStatus=ne.LOADING_FAILED,this._detachErrorHandler(this._onerror))},e._appendSourceElement=function(t){var e,n;if("object"==typeof t?(e=t.src,n=t.type):"string"==typeof t&&(e=t),!e)return!1;var i=document.createElement("source");return i.src=e,n&&(i.type=n),this._video.appendChild(i),!0},e.set=function(t){var e=this;this._reset(),t&&(t instanceof HTMLVideoElement?this._video=t:"string"!=typeof t&&"object"!=typeof t||(this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.setAttribute("webkit-playsinline",""),this._video.setAttribute("playsinline",""),t instanceof Array?t.forEach((function(t){return e._appendSourceElement(t)})):this._appendSourceElement(t),this._sourceCount=this._video.querySelectorAll("source").length,this._sourceCount>0?this._video.readyState<this._thresholdReadyState&&(this._video.load(),this._attachErrorHandler(this._onerror)):this._video=null))},e._attachErrorHandler=function(t){this._video.addEventListener("error",t),this._sources=this._video.querySelectorAll("source"),[].forEach.call(this._sources,(function(e){e.addEventListener("error",t)}))},e._detachErrorHandler=function(t){this._video.removeEventListener("error",t),[].forEach.call(this._sources,(function(e){e.removeEventListener("error",t)}))},e.get=function(){var t=this;return new ee((function(e,n){if(t._video)if(t._loadStatus===ne.LOADING_FAILED)n("VideoLoader: video source is invalid");else if(t._video.readyState>=t._thresholdReadyState)e(t._video);else{t._attachErrorHandler((function e(){t._loadStatus===ne.LOADING_FAILED&&(t._detachErrorHandler(e),n("VideoLoader: video source is invalid"))})),t._once(t._thresholdEventName,(function(){return e(t._video)}))}else n("VideoLoader: video is undefined")}))},e.getElement=function(){return this._video},e.destroy=function(){this._reset()},e._reset=function(){var t=this;this._handlers.forEach((function(e){t._video.removeEventListener(e.type,e.fn)})),this._handlers=[],this._video=null,this._sourceCount=0,this._errorCount=0},e._once=function(t,e){var n=this._video,i=function i(r){n.removeEventListener(t,i),e(r)};n.addEventListener(t,i,!0),this._handlers.push({type:t,fn:i})},t}(),oe="undefined"!=typeof window&&window||{},ae=(oe.RegExp,oe.navigator),se={browser:[{criteria:"PhantomJS",identity:"PhantomJS"},{criteria:/Whale/,identity:"Whale",versionSearch:"Whale"},{criteria:/Edge/,identity:"Edge",versionSearch:"Edge"},{criteria:/MSIE|Trident|Windows Phone/,identity:"IE",versionSearch:"IEMobile|MSIE|rv"},{criteria:/MiuiBrowser/,identity:"MIUI Browser",versionSearch:"MiuiBrowser"},{criteria:/SamsungBrowser/,identity:"Samsung Internet",versionSearch:"SamsungBrowser"},{criteria:/SAMSUNG /,identity:"Samsung Internet",versionSearch:"Version"},{criteria:/Chrome|CriOS/,identity:"Chrome"},{criteria:/Android/,identity:"Android Browser",versionSearch:"Version"},{criteria:/iPhone|iPad/,identity:"Safari",versionSearch:"Version"},{criteria:"Apple",identity:"Safari",versionSearch:"Version"},{criteria:"Firefox",identity:"Firefox"}],os:[{criteria:/Windows Phone/,identity:"Windows Phone",versionSearch:"Windows Phone"},{criteria:"Windows 2000",identity:"Window",versionAlias:"5.0"},{criteria:/Windows NT/,identity:"Window",versionSearch:"Windows NT"},{criteria:/iPhone|iPad/,identity:"iOS",versionSearch:"iPhone OS|CPU OS"},{criteria:"Mac",versionSearch:"OS X",identity:"MAC"},{criteria:/Android/,identity:"Android"},{criteria:/Tizen/,identity:"Tizen"},{criteria:/Web0S/,identity:"WebOS"}],webview:[{criteria:/iPhone|iPad/,browserVersionSearch:"Version",webviewBrowserVersion:/-1/},{criteria:/iPhone|iPad|Android/,webviewToken:/NAVER|DAUM|; wv/}],defaultString:{browser:{version:"-1",name:"unknown"},os:{version:"-1",name:"unknown"}}};function ue(t,e){for(var n=[],i=0;i<t.length;i++)e(t[i])&&n.push(t[i]);return n}var he=void 0;function ce(t,e){return e&&e.test?!!e.test(t):t.indexOf(e)>-1}function le(t,e){var n=ue(t,(function(t){return ce(he,t.criteria)}))[0];return n&&n.identity||e.name}function de(t,e){return ue(t,(function(t){var n=t.criteria,i=new RegExp(t.identity,"i").test(e);return!!(n?i&&ce(he,n):i)}))[0]}function fe(t,e){var n=se.defaultString.browser.version,i=new RegExp("("+t+")","i").exec(e);if(!i)return n;var r=i.index,o=i[0];if(r>-1){var a=r+o.length+1;n=e.substring(a).split(" ")[0].replace(/_/g,".").replace(/;|\)/g,"")}return n}function _e(t){if(t)return fe(function(t){var e=de(se.browser,t);return e||(e={criteria:t,versionSearch:t,identity:t}),e}(t).versionSearch||t,he)}function ve(t){var e=function(t){return de(se.os,t)}(t)||{},n=se.defaultString.os.version,i=void 0;if(t){if(e.versionAlias)return e.versionAlias;var r=e.versionSearch||t,o=new RegExp("("+r+")\\s([\\d_\\.]+|\\d_0)","i");return o.exec(he)&&(i=o.exec(he)[2].replace(/_/g,".").replace(/;|\)/g,"")),i||n}}function ge(){var t=le(se.os,se.defaultString.os);return{name:t,version:ve(t)}}function pe(){var t,e,n=le(se.browser,se.defaultString.browser);return{name:n,version:_e(n),webview:(t=se.webview,e=void 0,function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(ue(t,(function(t){return ce(he,t.criteria)})),(function(t){return e=fe(t.browserVersionSearch,he),!(!ce(he,t.webviewToken)&&!ce(e,t.webviewBrowserVersion))})))}}function me(){!function(t){he=t}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae.userAgent);var t={os:ge(),browser:pe(),isMobile:-1!==he.indexOf("Mobi")};return t.browser.name=t.browser.name.toLowerCase(),t.os.name=t.os.name.toLowerCase(),t.os.version=t.os.version.toLowerCase(),"ios"===t.os.name&&t.browser.webview&&(t.browser.version="-1"),t}me.VERSION="2.1.5";var Ee,ye,we={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"},Re=null,xe=function(){function t(){}return t.createShader=function(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error(t.getShaderInfoLog(i)),null)},t.createProgram=function(t,e,n){var i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.detachShader(i,e),t.detachShader(i,n),t.deleteShader(e),t.deleteShader(n),t.getProgramParameter(i,t.LINK_STATUS)?i:(t.deleteProgram(i),null)},t.initBuffer=function(t,e,n,i,r){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,n,t.STATIC_DRAW),o&&(o.itemSize=i,o.numItems=n.length/i),void 0!==r&&(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,o.itemSize,t.FLOAT,!1,0,0)),o},t.getWebglContext=function(t,e){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,r=o({preserveDrawingBuffer:!1,antialias:!1,xrCompatible:!0},e);function a(t){return t.statusMessage}t.addEventListener("webglcontextcreationerror",a);for(var s=0;s<n.length;s++){try{i=t.getContext(n[s],r)}catch(t){}if(i)break}return t.removeEventListener("webglcontextcreationerror",a),i},t.createTexture=function(t,e){var n=t.createTexture();return t.bindTexture(e,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(e,null),n},t.isWebGLAvailable=function(){if(null===Re){var e=document.createElement("canvas"),n=t.getWebglContext(e);if(Re=!!n,n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}}return Re},t.isStableWebGL=function(){var t=me(),e=!0;return"android"===t.os.name&&parseFloat(t.os.version)<=4.3?e=!1:"android"===t.os.name&&4.4===parseFloat(t.os.version)&&"chrome"!==t.browser.name&&(e=!1),e},t.getErrorNameFromWebGLErrorCode=function(t){return t in we?we[t]:"UNKNOWN_ERROR"},t.texImage2D=function(t,e,n){try{t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}catch(t){console.error("WebGLUtils.texImage2D error:",t)}},t.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},t}(),Te=me(),Ce="ie"===Te.browser.name&&"11.0"===Te.browser.version,Ae={ERROR:"error"},be=function(){var t=function(t){function e(){var e;return(e=t.call(this)||this)._forceDimension=null,e._pixelCanvas=null,e._pixelContext=null,e}a(e,t);var n=e.prototype;return n.render=function(t){var e=t.gl,n=t.shaderProgram,i=t.indexBuffer,r=t.mvMatrix,o=t.pMatrix;e.uniformMatrix4fv(n.pMatrixUniform,!1,o),e.uniformMatrix4fv(n.mvMatrixUniform,!1,r),i&&e.drawElements(e.TRIANGLES,i.numItems,e.UNSIGNED_SHORT,0)},n.getDimension=function(t){return{width:t.naturalWidth||t.videoWidth,height:t.naturalHeight||t.videoHeight}},n.updateShaderData=function(t){},n._initPixelSource=function(t,e){if(Ce&&t instanceof HTMLVideoElement||e){var n=e||this.getDimension(t),i=n.width,r=n.height;this._pixelCanvas=document.createElement("canvas"),this._pixelCanvas.width=i,this._pixelCanvas.height=r,this._pixelContext=this._pixelCanvas.getContext("2d")}this._forceDimension=e},n._getPixelSource=function(t){if(!this._pixelCanvas)return t;var e=this.getDimension(t),n=this._forceDimension||e;return this._pixelCanvas.width!==n.width&&(this._pixelCanvas.width=n.width),this._pixelCanvas.height!==n.height&&(this._pixelCanvas.height=n.height),this._forceDimension?this._pixelContext.drawImage(t,0,0,e.width,e.height,0,0,n.width,n.height):this._pixelContext.drawImage(t,0,0),this._pixelCanvas},n._extractTileConfig=function(t){var e=Array.isArray(t.tileConfig)?t.tileConfig:Array.apply(void 0,Array(6)).map((function(){return t.tileConfig}));return e=e.map((function(t){return o({flipHorizontal:!1,rotation:0},t)}))},n._triggerError=function(t){console.error("Renderer Error:",t),this.trigger(Ae.ERROR,{message:"string"==typeof t?t:t.message})},e}(n);return t.EVENTS=Ae,t}(),Ie=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA=null!==e._VERTEX_POSITION_DATA?e._VERTEX_POSITION_DATA:[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1],e._VERTEX_POSITION_DATA},n.getIndexData=function(){if(e._INDEX_DATA)return e._INDEX_DATA;for(var t=[],n=this.getVertexPositionData(),i=0;i<n.length/3;i+=4)t.push(i,i+2,i+1,i,i+3,i+2);return e._INDEX_DATA=t,t},e.extractOrder=function(t){return t.order||"RLUDBF"},n.getTextureCoordData=function(t){var n=e.extractOrder(t),i=this.getVertexPositionData(),r=this._extractTileConfig(t);return"BFUDRL".split("").map((function(t){return r[n.indexOf(t)]})).map((function(t,e){for(var n=parseInt(t.rotation/90,10),r=t.flipHorizontal?[0,1,2,3]:[1,0,3,2],o=0;o<Math.abs(n);o++)t.flipHorizontal&&n>0||!t.flipHorizontal&&n<0?r.push(r.shift()):r.unshift(r.pop());for(var a=i.slice(12*e,12*e+12),s=[],u=0;u<4;u++)s[r[u]]=a.splice(0,3);return s})).join().split(",").map((function(t){return parseInt(t,10)}))},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n\tvVertexDirectionVector = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nuniform samplerCube uSampler;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n\tgl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n}"},n.updateTexture=function(t,n,i){var r=e.extractOrder(i),o={};r.split("").forEach((function(t,e){o[t]=e}));try{if(n instanceof Array)for(var a=0;a<6;a++){var s=o["RLUDBF"[a]];xe.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+a,n[s])}else for(var u=this.getMaxCubeMapTextureSize(t,n),h=0;h<6;h++){var c=o["RLUDBF"[h]],l=this.extractTileFromImage(n,c,u);xe.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+h,l)}}catch(t){this._triggerError(t)}},n.bindTexture=function(t,e,n,i){t.bindTexture(t.TEXTURE_CUBE_MAP,e),this.updateTexture(t,n,i)},n.getSourceTileSize=function(t){var e=this.getDimension(t),n=e.width,i=e.height,r=n/i;return r===1/6?n:6===r?i:r===2/3?n/2:n/3},n.extractTileFromImage=function(t,e,n){var i=this.getDimension(t).width,r=this.getSourceTileSize(t),o=document.createElement("canvas");o.width=n,o.height=n;var a=o.getContext("2d"),s=i/r,u=r*e%(r*s),h=parseInt(e/s,10)*r;return a.drawImage(t,u,h,r,r,0,0,n,n),o},n.getMaxCubeMapTextureSize=function(t,e){var n=me(),i=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),r=this.getSourceTileSize(e);if("ie"===n.browser.name&&11===parseInt(n.browser.version,10)&&!_t.isPowerOfTwo(r))for(var o=1;o<i;o*=2)if(!(o<r)){r=o;break}return"ios"===n.os.name&&9===parseInt(n.os.version,10)&&(r=1024),"ios"===n.os.name&&8===parseInt(n.os.version,10)&&(r=512),Math.min(i,r)},e}(be);return t._VERTEX_POSITION_DATA=null,t._INDEX_DATA=null,t}(),Se=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvTextureCoord = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\n#define PI 3.14159265359\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool uIsEAC;\nconst vec2 OPERATE_COORDS_RANGE = vec2(-1.0, 1.0);\nconst vec2 TEXTURE_COORDS_RANGE = vec2(0.0, 1.0);\n// vector type is used for initializing values instead of array.\nconst vec4 TEXTURE_DIVISION_X = vec4(0.0, 1.0 / 3.0, 2.0 / 3.0, 1.0);\nconst vec3 TEXTURE_DIVISION_Y = vec3(0.0, 1.0 / 2.0, 1.0);\nconst float EAC_CONST = 2.0 / PI;\nfloat scale(vec2 domainRange, vec2 targetRange, float val) {\n\tfloat unit = 1.0 / (domainRange[1] - domainRange[0]);\n\treturn targetRange[0] + (targetRange[1] - targetRange[0]) * (val - domainRange[0]) * unit;\n}\nvoid main(void) {\n\tfloat transformedCoordX;\n\tfloat transformedCoordY;\n\n\tif (uIsEAC) {\n\t\tvec2 orgTextureRangeX;\n\t\tvec2 orgTextureRangeY;\n\n\t\t// Apply EAC transform\n\t\tif (vTextureCoord.s >= TEXTURE_DIVISION_X[2]) {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[2], TEXTURE_DIVISION_X[3]);\n\t\t} else if (vTextureCoord.s >= TEXTURE_DIVISION_X[1]) {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[1], TEXTURE_DIVISION_X[2]);\n\t\t} else {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[0], TEXTURE_DIVISION_X[1]);\n\t\t}\n\n\t\tif (vTextureCoord.t >= TEXTURE_DIVISION_Y[1]) {\n\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[1], TEXTURE_DIVISION_Y[2]);\n\t\t} else {\n\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[0], TEXTURE_DIVISION_Y[1]);\n\t\t}\n\n\t\t// scaling coors by the coordinates following the range from -1.0 to 1.0.\n\t\tfloat px = scale(orgTextureRangeX, OPERATE_COORDS_RANGE, vTextureCoord.s);\n\t\tfloat py = scale(orgTextureRangeY, OPERATE_COORDS_RANGE, vTextureCoord.t);\n\n\t\tfloat qu = EAC_CONST * atan(px) + 0.5;\n\t\tfloat qv = EAC_CONST * atan(py) + 0.5;\n\n\t\t// re-scaling coors by original coordinates ranges\n\t\ttransformedCoordX = scale(TEXTURE_COORDS_RANGE, orgTextureRangeX, qu);\n\t\ttransformedCoordY = scale(TEXTURE_COORDS_RANGE, orgTextureRangeY, qv);\n\t} else {\n\t\t// normal cubemap\n\t\ttransformedCoordX = vTextureCoord.s;\n\t\ttransformedCoordY = vTextureCoord.t;\n\t}\n\n\tgl_FragColor = texture2D(uSampler, vec2(transformedCoordX, transformedCoordY));\n}"},n.getVertexPositionData=function(){return this._vertices||(this._vertices=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]),this._vertices},n.getIndexData=function(){var t=this;return function(){for(var e=[],n=0;n<t._vertices.length/3;n+=4)e.push(n,n+1,n+2,n,n+2,n+3);return e}()},n.getTextureCoordData=function(t){for(var e=this,n=t.order||"RLUDFB",i=[],r=1;r>=0;r--)for(var o=0;o<3;o++){var a=[o/3,r/2,(o+1)/3,r/2,(o+1)/3,(r+1)/2,o/3,(r+1)/2];i.push(a)}var s=this._extractTileConfig(t);return i=i.map((function(t){return e._shrinkCoord(t)})).map((function(t,n){return e._transformCoord(t,s[n])})),"BFUDRL".split("").map((function(t){return n.indexOf(t)})).map((function(t){return i[t]})).reduce((function(t,e){return t.concat(e)}),[])},n.updateTexture=function(t,e){xe.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i=this.getDimension(n),r=i.width,o=i.height,a=Math.max(r,o),s=xe.getMaxTextureSize(t);a>s?this._triggerError("Image width("+r+") exceeds device limit("+s+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},n._transformCoord=function(t,e){var n=t.slice();return e.flipHorizontal&&(n=this._flipHorizontalCoord(n)),e.rotation&&(n=this._rotateCoord(n,e.rotation)),n},n._shrinkCoord=function(t){return[t[0]+0,t[1]+0,t[2]-0,t[3]+0,t[4]-0,t[5]-0,t[6]+0,t[7]-0]},n._rotateCoord=function(t,e){var n,i=parseInt(e/90,10)%4;if(0===i)return t;var r=[];return i>0?(n=t.splice(0,2*i),r=t.concat(n)):r=(n=t.splice(2*(4+i),2*-i)).concat(t),r},n._flipHorizontalCoord=function(t){return[t[2],t[3],t[0],t[1],t[6],t[7],t[4],t[5]]},e}(be),Pe={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,FAIL_BIND_TEXTURE:13,INVALID_RESOURCE:14,RENDERING_CONTEXT_LOST:15},Oe={READY:"ready",VIEW_CHANGE:"viewChange",ANIMATION_END:"animationEnd",ERROR:"error"},De={EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",CUBESTRIP:"cubestrip",PANORAMA:"panorama",STEREOSCOPIC_EQUI:"stereoequi"},Me={TOP_BOTTOM:"3dv",LEFT_RIGHT:"3dh",NONE:""},Le=-.5*Math.PI,Ne=[],Ve=[],Ue=[];for(Ee=0;Ee<=60;Ee++){var Fe=(Ee/60-.5)*Math.PI,Be=Math.sin(Fe),We=Math.cos(Fe);for(ye=0;ye<=60;ye++){var Xe=2*(ye/60-.5)*Math.PI+Le,Ye=Math.sin(Xe),He=Math.cos(Xe)*We,Ge=Be,ke=Ye*We,je=ye/60,qe=Ee/60;if(Ne.push(je,qe),Ve.push(2*He,2*Ge,2*ke),60!==ye&&60!==Ee){var ze=61*Ee+ye,Qe=ze+60+1;Ue.push(ze,Qe,ze+1,Qe,Qe+1,ze+1)}}}var Ke=function(){var t=function(t){function e(e){var n;return(n=t.call(this)||this)._stereoFormat=e,n}a(e,t);var n=e.prototype;return n.render=function(e){var n,i,r=e.gl,o=e.shaderProgram;switch(this._stereoFormat){case Me.TOP_BOTTOM:n=[1,.5,0,0],i=[1,.5,0,.5];break;case Me.LEFT_RIGHT:n=[.5,1,0,0],i=[.5,1,.5,0];break;default:n=[1,1,0,0],i=[1,1,0,0]}var a=r.getUniformLocation(o,"uTexScaleOffset");r.uniform4fv(a,[].concat(n,i)),t.prototype.render.call(this,e)},n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform float uEye;\nuniform vec4 uTexScaleOffset[2];\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvec4 scaleOffset = uTexScaleOffset[int(uEye)];\n\tvTextureCoord = aTextureCoord.xy * scaleOffset.xy + scaleOffset.zw;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vTextureCoord.st);\n}"},n.updateTexture=function(t,e){xe.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i=this.getDimension(n),r=i.width,o=i.height,a=Math.max(r,o),s=xe.getMaxTextureSize(t);a>s?this._triggerError("Image width("+r+") exceeds device limit("+s+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},e}(be);return t._VERTEX_POSITION_DATA=Ve,t._TEXTURE_COORD_DATA=Ne,t._INDEX_DATA=Ue,t}(),Ze=[],Je=[],$e=[],tn=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvTextureCoord = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}"},n.updateTexture=function(t,e){xe.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i,r=this.getDimension(n),o=r.width,a=r.height,s=Math.max(o,a),u=xe.getMaxTextureSize(t);s>u&&(this._triggerError("Image width("+o+") exceeds device texture limit("+u+"))"),i=o>a?{width:u,height:u*a/o}:{width:u*o/a,height:u}),this._initPixelSource(n,i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n)},n.updateShaderData=function(t){var e,n,i,r,o,a=t.imageAspectRatio,s=void 0===a?6:a;if(s<1?(r=!0,o=1/s):(r=!1,o=s),o>=6){var u=360/o;n=2*Math.PI,i=Math.tan(f(u/2))}else n=o,i=.5;Ze.length=0,Je.length=0,$e.length=0;for(var h=[-i,i],c=Math.PI/2+(2*Math.PI-n)/2,l=0,d=h.length;l<d;l++)for(e=0;e<=60;e++){var _=c+e/60*n,v=Math.cos(_),g=h[l],p=Math.sin(_),m=void 0,E=void 0;if(r?(m=1-l,E=e/60):(m=e/60,E=l),Ze.push(m,E),Je.push(v,g,p),0===l&&e<60){var y=e,w=y+60+1;$e.push(y,w,y+1,w,w+1,y+1)}}},e}(be);return t._VERTEX_POSITION_DATA=Je,t._TEXTURE_COORD_DATA=Ze,t._INDEX_DATA=$e,t}(),en="undefined"==typeof Promise?h.Promise:Promise,nn=[0,0,.5,1],rn=[.5,0,.5,1],on="left",an="right",sn=function(){return function(){function t(){var t=this;this.destroy=function(){var e=t._vrDisplay;t.removeEndCallback(t.destroy),e&&e.isPresenting&&e.exitPresent(),t._clear()},this._frameData=new window.VRFrameData,this._clear()}r(t,[{key:"context",get:function(){return this._vrDisplay}}]);var e=t.prototype;return e.canRender=function(){return Boolean(this._vrDisplay)},e.beforeRender=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)},e.afterRender=function(){this._vrDisplay.submitFrame()},e.getEyeParams=function(t){var e=this._vrDisplay,n=.5*t.drawingBufferWidth,i=t.drawingBufferHeight,r=this._frameData;e.getFrameData(r);var o=r.leftViewMatrix,a=r.rightViewMatrix;return E(o,o,this._yawOffset),E(a,a,this._yawOffset),[{viewport:[0,0,n,i],mvMatrix:o,pMatrix:r.leftProjectionMatrix},{viewport:[n,0,n,i],mvMatrix:a,pMatrix:r.rightProjectionMatrix}]},e.isPresenting=function(){return Boolean(this._vrDisplay&&this._vrDisplay.isPresenting)},e.addEndCallback=function(t){window.addEventListener("vrdisplaypresentchange",t)},e.removeEndCallback=function(t){window.removeEventListener("vrdisplaypresentchange",t)},e.requestPresent=function(t){var e=this;return new en((function(n,i){navigator.getVRDisplays().then((function(r){var o=r.length&&r[0];o?o.capabilities.canPresent?o.requestPresent([{source:t}]).then((function(){var i=o.getEyeParameters(on),r=o.getEyeParameters(an);t.width=2*Math.max(i.renderWidth,r.renderWidth),t.height=Math.max(i.renderHeight,r.renderHeight),e._setDisplay(o),n()})):i(new Error("Display lacking capability to present.")):i(new Error("No displays available."))}))}))},e.setYawOffset=function(t){this._yawOffset=t},e._setDisplay=function(t){this._vrDisplay=t;var e=t.getLayers();if(e.length){var n=e[0];this._leftBounds=n.leftBounds,this._rightBounds=n.rightBounds}this.addEndCallback(this.destroy)},e._clear=function(){this._vrDisplay=null,this._leftBounds=nn,this._rightBounds=rn,this._yawOffset=0},t}()}(),un=function(){return function(){function t(){var t=this;this.destroy=function(){var e=t._xrSession;t.removeEndCallback(t.destroy),e&&e.end().then((function(){}),(function(){})),t._clear()},this._clear()}r(t,[{key:"context",get:function(){return this._xrSession}}]);var e=t.prototype;return e.canRender=function(t){var e=t.getViewerPose(this._xrRefSpace);return Boolean(e)},e.beforeRender=function(t,e){var n=e.session.renderState.baseLayer;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer)},e.afterRender=function(){},e.getEyeParams=function(t,e){var n=this,i=e.session,r=e.getViewerPose(this._xrRefSpace);if(!r)return null;var o=i.renderState.baseLayer;return r.views.map((function(t){var e=o.getViewport(t),i=t.transform.inverse.matrix;return nt&&m(i,i,f(180)),E(i,i,n._yawOffset),{viewport:[e.x,e.y,e.width,e.height],mvMatrix:i,pMatrix:t.projectionMatrix}}))},e.isPresenting=function(){return this._presenting},e.addEndCallback=function(t){var e=this._xrSession;e&&e.addEventListener("end",t)},e.removeEndCallback=function(t){var e=this._xrSession;e&&e.removeEventListener("end",t)},e.requestPresent=function(t,e){var n=this;return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local"]}).then((function(t){var i=new window.XRWebGLLayer(t,e);return t.updateRenderState({baseLayer:i}),t.requestReferenceSpace("local").then((function(e){n._setSession(t,i,e)}))}))},e.setYawOffset=function(t){this._yawOffset=t},e._setSession=function(t,e,n){this._xrSession=t,this._xrLayer=e,this._xrRefSpace=n,this._presenting=!0,this.addEndCallback(this.destroy)},e._clear=function(){this._xrSession=null,this._xrLayer=null,this._xrRefSpace=null,this._presenting=!1,this._yawOffset=0},t}()}(),hn=function(){return function(){function t(){var t=this;this._onLoop=function(){t._callback.apply(t,arguments),t._rafId=t._context.requestAnimationFrame(t._onLoop)},this._onLoopNextTick=function(){var e=performance.now();t._callback.apply(t,arguments);var n=performance.now()-e;t._rafTimer>=0&&(clearTimeout(t._rafTimer),t._rafTimer=-1),n<16?t._rafId=t._context.requestAnimationFrame(t._onLoop):t._rafTimer=setTimeout(t._onLoop,0)},this._callback=null,this._context=window,this._rafId=-1,this._rafTimer=-1}var e=t.prototype;return e.setCallback=function(t){this._callback=t},e.setContext=function(t){this._context=t},e.start=function(){var t=this._context,e=this._callback;t&&e&&(this._rafId>=0||this._rafTimer>=0||(this._rafId=nt?t.requestAnimationFrame(this._onLoopNextTick):t.requestAnimationFrame(this._onLoop)))},e.stop=function(){this._rafId>=0&&this._context.cancelAnimationFrame(this._rafId),this._rafTimer>=0&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1},t}()}(),cn="undefined"==typeof Promise?h.Promise:Promise,ln=De,dn=ut||1;dn>2&&(dn=2);var fn={BIND_TEXTURE:"bindTexture",IMAGE_LOADED:"imageLoaded",ERROR:"error",RENDERING_CONTEXT_LOST:"renderingContextLost",RENDERING_CONTEXT_RESTORE:"renderingContextRestore"},_n={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,RENDERER_ERROR:13},vn=function(){var t=function(t){function e(e,n,i,r,o,a){var u;return(u=t.call(this)||this)._renderStereo=function(t,e){var n=u._vr,i=u.context,r=n.getEyeParams(i,e);if(r){n.beforeRender(i,e);for(var o=0,a=[0,1];o<a.length;o++){var s=a[o],h=r[s];u.mvMatrix=h.mvMatrix,u.pMatrix=h.pMatrix,i.viewport.apply(i,h.viewport),i.uniform1f(u.shaderProgram.uEye,s),u._bindBuffers(),u._draw()}n.afterRender()}},u.exitVR=function(){var t=u._vr,e=u.context,n=u._animator;t&&(t.removeEndCallback(u.exitVR),t.destroy(),u._vr=null,et&&u._restoreStyle(),u.updateViewportDimensions(u.width,u.height),u._updateViewport(),e.bindFramebuffer(e.FRAMEBUFFER,null),u._bindBuffers(),u._shouldForceDraw=!0,n.stop(),n.setContext(window),n.setCallback(u._render.bind(s(u))),n.start())},u._onFirstVRFrame=function(t,e){var n=u._vr,i=u.context,r=u._animator;if(n.canRender(e)){var o=x(0,0,-1),a=n.getEyeParams(i,e)[0],s=v(_(),a.mvMatrix),h=v(_(),a.pMatrix),c=g(_(),s),l=g(_(),h),d=I(w(),o,l);I(d,d,c);var f=_t.yawOffsetBetween(d,x(0,0,1));0!==f&&(n.setYawOffset(f),r.setCallback(u._renderStereo))}},u.sphericalConfig=o,u.fieldOfView=o.fieldOfView,u.width=n,u.height=i,u._lastQuaternion=null,u._lastYaw=null,u._lastPitch=null,u._lastFieldOfView=null,u.pMatrix=p(),u.mvMatrix=p(),y(u.pMatrix,f(u.fieldOfView),n/i,.1,100),u.textureCoordBuffer=null,u.vertexBuffer=null,u.indexBuffer=null,u.canvas=u._initCanvas(n,i),u._setDefaultCanvasStyle(),u._wrapper=null,u._wrapperOrigStyle=null,u._renderingContextAttributes=a,u._image=null,u._imageConfig=null,u._imageIsReady=!1,u._shouldForceDraw=!1,u._keepUpdate=!1,u._onContentLoad=u._onContentLoad.bind(s(u)),u._onContentError=u._onContentError.bind(s(u)),u._animator=new hn,u._vr=null,e&&u.setImage({image:e,imageType:o.imageType,isVideo:r,cubemapConfig:o.cubemapConfig}),u}a(e,t);var n=e.prototype;return n.setYawPitchControl=function(t){this._yawPitchControl=t},n.getContent=function(){return this._image},n.setImage=function(t){var e=t.image,n=t.imageType,i=t.isVideo,r=void 0!==i&&i,a=t.cubemapConfig;return this._imageIsReady=!1,this._isVideo=r,this._imageConfig=o({order:n===ln.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0}},a),this._setImageType(n),this._contentLoader&&this._contentLoader.destroy(),r?(this._contentLoader=new re,this._keepUpdate=!0):(this._contentLoader=new te,this._keepUpdate=!1),this._contentLoader.set(e),this._image=this._contentLoader.getElement(),this._contentLoader.get().then(this._onContentLoad,this._onContentError).catch((function(t){return setTimeout((function(){throw t}))}))},n._setImageType=function(t){var e=this;if(t&&this._imageType!==t){switch(this._imageType=t,this._isCubeMap=t===ln.CUBEMAP,this._renderer&&this._renderer.off(),t){case ln.CUBEMAP:this._renderer=new Ie;break;case ln.CUBESTRIP:this._renderer=new Se;break;case ln.PANORAMA:this._renderer=new tn;break;case ln.STEREOSCOPIC_EQUI:this._renderer=new Ke(this.sphericalConfig.stereoFormat);break;default:this._renderer=new Ke(Me.NONE)}this._renderer.on(be.EVENTS.ERROR,(function(t){e.trigger(fn.ERROR,{type:_n.RENDERER_ERROR,message:t.message})})),this._initWebGL()}},n._initCanvas=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,this._onWebglcontextlost=this._onWebglcontextlost.bind(this),this._onWebglcontextrestored=this._onWebglcontextrestored.bind(this),n.addEventListener("webglcontextlost",this._onWebglcontextlost),n.addEventListener("webglcontextrestored",this._onWebglcontextrestored),n},n._setDefaultCanvasStyle=function(){var t=this.canvas;t.style.bottom=0,t.style.left=0,t.style.right=0,t.style.top=0,t.style.margin="auto",t.style.maxHeight="100%",t.style.maxWidth="100%",t.style.outline="none",t.style.position="absolute"},n._onContentError=function(t){return this._imageIsReady=!1,this._image=null,this.trigger(fn.ERROR,{type:_n.FAIL_IMAGE_LOAD,message:"failed to load image"}),!1},n._triggerContentLoad=function(){this.trigger(fn.IMAGE_LOADED,{content:this._image,isVideo:this._isVideo,projectionType:this._imageType})},n._onContentLoad=function(t){return this._imageIsReady=!0,this._triggerContentLoad(),!0},n.isImageLoaded=function(){return!!this._image&&this._imageIsReady&&(!this._isVideo||this._image.readyState>=2)},n.bindTexture=function(){var t=this;return new cn((function(e,n){t._contentLoader?t._contentLoader.get().then((function(){t._bindTexture()}),n).then(e):n("ImageLoader is not initialized")}))},n.attachTo=function(t){this.detach(),t.appendChild(this.canvas),this._wrapper=t},n.forceContextLoss=function(){if(this.hasRenderingContext()){var t=this.context.getExtension("WEBGL_lose_context");t&&t.loseContext()}},n.detach=function(){this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},n.destroy=function(){this._contentLoader&&this._contentLoader.destroy(),this._animator.stop(),this.detach(),this.forceContextLoss(),this.off(),this.canvas.removeEventListener("webglcontextlost",this._onWebglcontextlost),this.canvas.removeEventListener("webglcontextrestored",this._onWebglcontextrestored)},n.hasRenderingContext=function(){return!(!this.context||this.context.isContextLost())&&!(this.context&&!this.context.getProgramParameter(this.shaderProgram,this.context.LINK_STATUS))},n._initShaderProgram=function(){var t=this.context;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null);var e=this._renderer,n=e.getVertexShaderSource(),i=e.getFragmentShaderSource(),r=xe.createShader(t,t.VERTEX_SHADER,n),o=xe.createShader(t,t.FRAGMENT_SHADER,i),a=xe.createProgram(t,r,o);if(!a)throw new Error("Failed to intialize shaders: "+xe.getErrorNameFromWebGLErrorCode(t.getError()));t.useProgram(a),a.vertexPositionAttribute=t.getAttribLocation(a,"aVertexPosition"),t.enableVertexAttribArray(a.vertexPositionAttribute),a.pMatrixUniform=t.getUniformLocation(a,"uPMatrix"),a.mvMatrixUniform=t.getUniformLocation(a,"uMVMatrix"),a.samplerUniform=t.getUniformLocation(a,"uSampler"),a.textureCoordAttribute=t.getAttribLocation(a,"aTextureCoord"),a.uEye=t.getUniformLocation(a,"uEye"),t.enableVertexAttribArray(a.textureCoordAttribute),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.uniform1i(a.samplerUniform,0),this.shaderProgram=a},n._onWebglcontextlost=function(t){t.preventDefault(),this.trigger(fn.RENDERING_CONTEXT_LOST)},n._onWebglcontextrestored=function(t){this._initWebGL(),this.trigger(fn.RENDERING_CONTEXT_RESTORE)},n.updateFieldOfView=function(t){this.fieldOfView=t,this._updateViewport()},n.updateViewportDimensions=function(t,e){var n=!1;this.width=t,this.height=e;var i=t*dn,r=e*dn;i!==this.canvas.width&&(this.canvas.width=i,n=!0),r!==this.canvas.height&&(this.canvas.height=r,n=!0),n&&(this._updateViewport(),this._shouldForceDraw=!0)},n._updateViewport=function(){y(this.pMatrix,f(this.fieldOfView),this.canvas.width/this.canvas.height,.1,100),this.context.viewport(0,0,this.context.drawingBufferWidth,this.context.drawingBufferHeight)},n._initWebGL=function(){var t;try{this._initRenderingContext(),t=this.context,this.updateViewportDimensions(this.width,this.height),this._initShaderProgram()}catch(t){return this.trigger(fn.ERROR,{type:_n.NO_WEBGL,message:"no webgl support"}),this.destroy(),void console.error(t)}t.clearColor(0,0,0,0);var e=this._isCubeMap?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this.texture&&t.deleteTexture(this.texture),this.texture=xe.createTexture(t,e),this._imageType===ln.CUBESTRIP&&t.enable(t.CULL_FACE)},n._initRenderingContext=function(){if(!this.hasRenderingContext()){if(!window.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");if(this.context=xe.getWebglContext(this.canvas,this._renderingContextAttributes),!this.context)throw new Error("Failed to acquire 3D rendering context")}},n._initBuffers=function(){var t=this._renderer.getVertexPositionData(),e=this._renderer.getIndexData(),n=this._renderer.getTextureCoordData(this._imageConfig),i=this.context;this.vertexBuffer=xe.initBuffer(i,i.ARRAY_BUFFER,new Float32Array(t),3,this.shaderProgram.vertexPositionAttribute),this.indexBuffer=xe.initBuffer(i,i.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),1),this.textureCoordBuffer=xe.initBuffer(i,i.ARRAY_BUFFER,new Float32Array(n),this._isCubeMap?3:2,this.shaderProgram.textureCoordAttribute),this._bindBuffers()},n._bindTexture=function(){if(this._imageType===ln.CUBESTRIP){var t=this._renderer.getDimension(this._image),e=t.width,n=t.height,i=e&&n&&e/n!=1.5;this.context.uniform1f(this.context.getUniformLocation(this.shaderProgram,"uIsEAC"),i)}else if(this._imageType===ln.PANORAMA){var r=this._renderer.getDimension(this._image),o=r.width,a=r.height,s=o&&a&&o/a;this._renderer.updateShaderData({imageAspectRatio:s})}this._initBuffers(),this._renderer.bindTexture(this.context,this.texture,this._image,this._imageConfig),this._shouldForceDraw=!0,this.trigger(fn.BIND_TEXTURE)},n._updateTexture=function(){this._renderer.updateTexture(this.context,this._image,this._imageConfig)},n.keepUpdate=function(t){t&&!1===this.isImageLoaded()&&(this._shouldForceDraw=!0),this._keepUpdate=t},n.startRender=function(){this._animator.setCallback(this._render.bind(this)),this._animator.start()},n.stopRender=function(){this._animator.stop()},n.renderWithQuaternion=function(t,e){this.isImageLoaded()&&(!1===this._keepUpdate&&this._lastQuaternion&&z(this._lastQuaternion,t)&&this.fieldOfView&&this.fieldOfView===e&&!1===this._shouldForceDraw||(void 0!==e&&e!==this.fieldOfView&&this.updateFieldOfView(e),this.mvMatrix=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],a=n+n,s=i+i,u=r+r,h=n*a,c=i*a,l=i*s,d=r*a,f=r*s,_=r*u,v=o*a,g=o*s,p=o*u;return t[0]=1-l-_,t[1]=c+p,t[2]=d-g,t[3]=0,t[4]=c-p,t[5]=1-h-_,t[6]=f+v,t[7]=0,t[8]=d+g,t[9]=f-v,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(p(),t),this._draw(),this._lastQuaternion=G(t),this._shouldForceDraw&&(this._shouldForceDraw=!1)))},n.renderWithYawPitch=function(t,e,n){var i;this.isImageLoaded()&&(!1===this._keepUpdate&&null!==this._lastYaw&&this._lastYaw===t&&null!==this._lastPitch&&this._lastPitch===e&&this.fieldOfView&&this.fieldOfView===n&&!1===this._shouldForceDraw||(void 0!==n&&n!==this.fieldOfView&&this.updateFieldOfView(n),(i=this.mvMatrix)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,m(this.mvMatrix,this.mvMatrix,-f(e)),E(this.mvMatrix,this.mvMatrix,-f(t)),this._draw(),this._lastYaw=t,this._lastPitch=e,this._shouldForceDraw&&(this._shouldForceDraw=!1)))},n._render=function(){var t=this._yawPitchControl,e=t.getFov();if(t.shouldRenderWithQuaternion()){var n=t.getQuaternion();this.renderWithQuaternion(n,e)}else{var i=t.getYawPitch();this.renderWithYawPitch(i.yaw,i.pitch,e)}},n._bindBuffers=function(){var t=this.context,e=this.shaderProgram,n=this.vertexBuffer,i=this.textureCoordBuffer;t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(e.vertexPositionAttribute),t.vertexAttribPointer(e.vertexPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(e.textureCoordAttribute),t.vertexAttribPointer(e.textureCoordAttribute,i.itemSize,t.FLOAT,!1,0,0)},n._draw=function(){this._isVideo&&this._keepUpdate&&this._updateTexture(),this._renderer.render({gl:this.context,shaderProgram:this.shaderProgram,indexBuffer:this.indexBuffer,mvMatrix:this.mvMatrix,pMatrix:this.pMatrix})},n.getProjectionRenderer=function(){return this._renderer},n.enterVR=function(){var t=this._vr;return lt||navigator.getVRDisplays?t&&t.isPresenting()?cn.resolve("VR already enabled."):this._requestPresent():cn.reject("VR is not available on this browser.")},n._requestPresent=function(){var t=this,e=this.context,n=this.canvas,i=this._animator;this._vr=lt?new un:new sn;var r=this._vr;return i.stop(),new cn((function(o,a){r.requestPresent(n,e).then((function(){r.addEndCallback(t.exitVR),i.setContext(r.context),i.setCallback(t._onFirstVRFrame),et&&t._setWrapperFullscreen(),t._shouldForceDraw=!0,i.start(),o("success")})).catch((function(e){r.destroy(),t._vr=null,i.start(),a(e)}))}))},n._setWrapperFullscreen=function(){var t=this._wrapper;if(t){this._wrapperOrigStyle=t.getAttribute("style");var e=t.style;e.width="100vw",e.height="100vh",e.position="fixed",e.left="0",e.top="0",e.zIndex="9999"}},n._restoreStyle=function(){var t=this._wrapper,e=this.canvas;t&&(this._wrapperOrigStyle?t.setAttribute("style",this._wrapperOrigStyle):t.removeAttribute("style"),this._wrapperOrigStyle=null,e.removeAttribute("style"),this._setDefaultCanvasStyle())},e}(n);return t.EVENTS=fn,t.ERROR_TYPE=_n,t}(),gn="undefined"==typeof Promise?h.Promise:Promise,pn=function(){var t=function(t){function e(n,i){var r;if(void 0===i&&(i={}),r=t.call(this)||this,!xe.isWebGLAvailable())return setTimeout((function(){r.trigger(Oe.ERROR,{type:Pe.NO_WEBGL,message:"no webgl support"})}),0),s(r)||s(r);if(!xe.isStableWebGL())return setTimeout((function(){r.trigger(Oe.ERROR,{type:Pe.INVALID_DEVICE,message:"blacklisted browser"})}),0),s(r)||s(r);if(i.image&&i.video)return setTimeout((function(){r.trigger(Oe.ERROR,{type:Pe.INVALID_RESOURCE,message:"Specifying multi resouces(both image and video) is not valid."})}),0),s(r)||s(r);dt(),r._container=n,r._image=i.image||i.video,r._isVideo=!!i.video,r._projectionType=i.projectionType||De.EQUIRECTANGULAR,r._cubemapConfig=o({order:r._projectionType===De.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0}},i.cubemapConfig),r._stereoFormat=i.stereoFormat||Me.TOP_BOTTOM,r._width=i.width||parseInt(window.getComputedStyle(n).width,10),r._height=i.height||parseInt(window.getComputedStyle(n).height,10),r._yaw=i.yaw||0,r._pitch=i.pitch||0,r._fov=i.fov||65,r._gyroMode=i.gyroMode||Bt.YAWPITCH,r._quaternion=null,r._aspectRatio=0!==r._height?r._width/r._height:1;var a=i.fovRange||[30,110],u=e._isValidTouchDirection(i.touchDirection)?i.touchDirection:Kt.TOUCH_DIRECTION_ALL,h=o(i,{element:n,yaw:r._yaw,pitch:r._pitch,fov:r._fov,gyroMode:r._gyroMode,fovRange:a,aspectRatio:r._aspectRatio,touchDirection:u});return r._isReady=!1,r._initYawPitchControl(h),r._initRenderer(r._yaw,r._pitch,r._fov,r._projectionType,r._cubemapConfig),r}a(e,t);var n=e.prototype;return n.getVideo=function(){return this._isVideo?this._photoSphereRenderer.getContent():null},n.setVideo=function(t,e){return void 0===e&&(e={}),t&&this.setImage(t,{projectionType:e.projectionType,isVideo:!0,cubemapConfig:e.cubemapConfig,stereoFormat:e.stereoFormat}),this},n.getImage=function(){return this._isVideo?null:this._photoSphereRenderer.getContent()},n.setImage=function(t,e){void 0===e&&(e={});var n=o({order:"RLUDBF",tileConfig:{flipHorizontal:!1,rotation:0}},e.cubemapConfig),i=e.stereoFormat||Me.TOP_BOTTOM,r=!!e.isVideo;return this._image&&this._isVideo!==r?(console.warn("Currently not supporting to change content type(Image <--\x3e Video)"),this):(t&&(this._image=t,this._isVideo=r,this._projectionType=e.projectionType||De.EQUIRECTANGULAR,this._cubemapConfig=n,this._stereoFormat=i,this._deactivate(),this._initRenderer(this._yaw,this._pitch,this._fov,this._projectionType,this._cubemapConfig)),this)},n.keepUpdate=function(t){return this._photoSphereRenderer.keepUpdate(t),this},n.getProjectionType=function(){return this._projectionType},n.enableSensor=function(){return this._yawPitchControl.enableSensor()},n.disableSensor=function(){return this._yawPitchControl.disableSensor(),this},n.enterVR=function(){var t=this;return this._isReady?new gn((function(e,n){t.enableSensor().then((function(){return t._photoSphereRenderer.enterVR()})).then((function(t){return e(t)})).catch((function(t){return n(t)}))})):gn.reject(new Error("PanoViewer is not ready to show image."))},n.exitVR=function(){return this._photoSphereRenderer.exitVR(),this},n._initRenderer=function(t,e,n,i,r){var o=this;this._photoSphereRenderer=new vn(this._image,this._width,this._height,this._isVideo,{initialYaw:t,initialPitch:e,fieldOfView:n,imageType:i,cubemapConfig:r,stereoFormat:this._stereoFormat}),this._photoSphereRenderer.setYawPitchControl(this._yawPitchControl),this._bindRendererHandler(),this._photoSphereRenderer.bindTexture().then((function(){return o._activate()})).catch((function(){o._triggerEvent(Oe.ERROR,{type:Pe.FAIL_BIND_TEXTURE,message:"failed to bind texture"})}))},n._updateYawPitchIfNeeded=function(){if(this._projectionType===e.ProjectionType.PANORAMA){var t,n,i,r=this._photoSphereRenderer.getContent(),o=r.naturalWidth/r.naturalHeight;o<1&&(o=1/o),o<6?(n=_t.toDegree(o),t=!1,i=2*_t.toDegree(Math.atan(.5))):(n=360,t=!0,i=360/o);var a=this._yawPitchControl.option("fovRange")[0];this._yawPitchControl.option({fov:i,yawRange:[-n/2,n/2],isCircular:t,pitchRange:[-i/2,i/2],fovRange:[a,i]}),this.lookAt({fov:i})}},n._bindRendererHandler=function(){var t=this;this._photoSphereRenderer.on(vn.EVENTS.ERROR,(function(e){t.trigger(Oe.ERROR,e)})),this._photoSphereRenderer.on(vn.EVENTS.RENDERING_CONTEXT_LOST,(function(e){t._deactivate(),t.trigger(Oe.ERROR,{type:Pe.RENDERING_CONTEXT_LOST,message:"webgl rendering context lost"})}))},n._initYawPitchControl=function(t){var e=this;this._yawPitchControl=new Kt(t),this._yawPitchControl.on(Oe.ANIMATION_END,(function(t){e._triggerEvent(Oe.ANIMATION_END,t)})),this._yawPitchControl.on("change",(function(t){e._yaw=t.yaw,e._pitch=t.pitch,e._fov=t.fov,e._quaternion=t.quaternion,e._triggerEvent(Oe.VIEW_CHANGE,t)}))},n._triggerEvent=function(t,e){var n=e||{};return this.trigger(t,n)},n.setUseZoom=function(t){return"boolean"==typeof t&&this._yawPitchControl.option("useZoom",t),this},n.setUseKeyboard=function(t){return this._yawPitchControl.option("useKeyboard",t),this},n.setGyroMode=function(t){return this._yawPitchControl.option("gyroMode",t),this},n.setFovRange=function(t){return this._yawPitchControl.option("fovRange",t),this},n.getFovRange=function(){return this._yawPitchControl.option("fovRange")},n.updateViewportDimensions=function(t){if(void 0===t&&(t={width:void 0,height:void 0}),!this._isReady)return this;var e;void 0!==t.width&&void 0!==t.height||(e=window.getComputedStyle(this._container));var n=t.width||parseInt(e.width,10),i=t.height||parseInt(e.height,10);return n===this._width&&i===this._height?this:(this._width=n,this._height=i,this._aspectRatio=n/i,this._photoSphereRenderer.updateViewportDimensions(n,i),this._yawPitchControl.option("aspectRatio",this._aspectRatio),this._yawPitchControl.updatePanScale({height:i}),this.lookAt({},0),this)},n.getFov=function(){return this._fov},n._getHFov=function(){return _t.toDegree(2*Math.atan(this._aspectRatio*Math.tan(f(this._fov)/2)))},n.getYaw=function(){return this._yaw},n.getPitch=function(){return this._pitch},n.getYawRange=function(){return this._yawPitchControl.option("yawRange")},n.getPitchRange=function(){return this._yawPitchControl.option("pitchRange")},n.setYawRange=function(t){return this._yawPitchControl.option("yawRange",t),this},n.setPitchRange=function(t){return this._yawPitchControl.option("pitchRange",t),this},n.setShowPolePoint=function(t){return this._yawPitchControl.option("showPolePoint",t),this},n.lookAt=function(t,e){if(!this._isReady)return this;var n=void 0!==t.yaw?t.yaw:this._yaw,i=void 0!==t.pitch?t.pitch:this._pitch,r=this._yawPitchControl.option("pitchRange"),o=r[1]-r[0],a=void 0!==t.fov?t.fov:this._fov;return o<a&&(a=o),this._yawPitchControl.lookAt({yaw:n,pitch:i,fov:a},e),0===e&&this._photoSphereRenderer.renderWithYawPitch(n,i,a),this},n._activate=function(){this._photoSphereRenderer.attachTo(this._container),this._yawPitchControl.enable(),this.updateViewportDimensions(),this._isReady=!0,this._updateYawPitchIfNeeded(),this._triggerEvent(Oe.READY),this._photoSphereRenderer.startRender()},n._deactivate=function(){this._isReady&&(this._photoSphereRenderer.stopRender(),this._yawPitchControl.disable(),this._isReady=!1),this._photoSphereRenderer&&(this._photoSphereRenderer.destroy(),this._photoSphereRenderer=null)},e._isValidTouchDirection=function(t){return t===e.TOUCH_DIRECTION.NONE||t===e.TOUCH_DIRECTION.YAW||t===e.TOUCH_DIRECTION.PITCH||t===e.TOUCH_DIRECTION.ALL},n.setTouchDirection=function(t){return e._isValidTouchDirection(t)&&this._yawPitchControl.option("touchDirection",t),this},n.getTouchDirection=function(){return this._yawPitchControl.option("touchDirection")},n.destroy=function(){return this._deactivate(),this._yawPitchControl&&(this._yawPitchControl.destroy(),this._yawPitchControl=null),this},e.isSupported=function(){return xe.isWebGLAvailable()&&xe.isStableWebGL()},e.isWebGLAvailable=function(){return xe.isWebGLAvailable()},e.isGyroSensorAvailable=function(t){var n;st?gn.race([new gn((function(t,e){n=function(e){var n=!(null==e.rotationRate.alpha);t(n)},window.addEventListener("devicemotion",n)})),new gn((function(t,e){setTimeout((function(){return t(!1)}),1e3)}))]).then((function(i){window.removeEventListener("devicemotion",n),t&&t(i),e.isGyroSensorAvailable=function(t){return t&&t(i),i}})):t&&t(!1)},e}(n);return t.VERSION=kt,t.ERROR_TYPE=Pe,t.EVENTS=Oe,t.PROJECTION_TYPE=De,t.GYRO_MODE=Bt,t.ProjectionType=De,t.STEREO_FORMAT=Me,t.TOUCH_DIRECTION={NONE:Kt.TOUCH_DIRECTION_NONE,YAW:Kt.TOUCH_DIRECTION_YAW,PITCH:Kt.TOUCH_DIRECTION_PITCH,ALL:Kt.TOUCH_DIRECTION_ALL},t}(),mn=function(){var t=function(t){function e(n,i){var r;r=t.call(this)||this;var o=i||{};return r._el=n,r._rowCount=o.rowCount||1,r._colCount=o.colCount||1,r._totalCount=r._rowCount*r._colCount,r._width=o.width||"auto",r._height=o.height||"auto",r._autoHeight=null!=o.autoHeight?o.autoHeight:"true",r._colRow=[0,0],o.colRow?r._colRow=o.colRow:o.frameIndex&&r.setFrameIndex(o.frameIndex),r._el.style.width=e._getSizeString(r._width),r._el.style.height=e._getSizeString(r._height),o.imageUrl?(r._image=new Image,r._image.onload=function(){r._bg=e._createBgDiv(r._image,r._rowCount,r._colCount,r._autoHeight),r._el.appendChild(r._bg),r.setColRow(r._colRow[0],r._colRow[1]),r.trigger("load",{target:r._el,bgElement:r._bg}),r._autoPlayReservedInfo&&(r.play(r._autoPlayReservedInfo),r._autoPlayReservedInfo=null)},r._image.onerror=function(t){r.trigger("imageError",{imageUrl:o.imageUrl})},r._image.src=o.imageUrl,r):(setTimeout((function(){r.trigger("imageError",{imageUrl:o.imageUrl})}),0),s(r))}a(e,t),e._createBgDiv=function(t,e,n,i){var r=document.createElement("div");r.style.position="relative",r.style.overflow="hidden",t.style.position="absolute",t.style.width=100*n+"%",t.style.height=100*e+"%",t.ondragstart=function(){return!1},ct&&(t.style.willChange="transform"),r.appendChild(t);var o=t.width/n,a=t.height/e;if(i){var s=a/o;r.style.paddingBottom=100*s+"%"}else r.style.height="100%";return r};var n=e.prototype;return n.setFrameIndex=function(t){var e=this.toColRow(t);this.setColRow(e[0],e[1])},n.getFrameIndex=function(){return this._colRow[1]*this._colCount+this._colRow[0]},n.setColRow=function(t,e){e>this._rowCount-1||t>this._colCount-1||(this._image&&ht&&(this._image.style[ht]="translate("+-t/this._colCount*100+"%, "+-e/this._rowCount*100+"%)"),this._colRow=[t,e])},n.getColRow=function(){return this._colRow},e._getSizeString=function(t){return"number"==typeof t?t+"px":t},n.stop=function(){this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=null)},n.play=function(t){var e=this,n=void 0===t?{interval:1e3/this._totalCount,playCount:0}:t,i=n.interval,r=n.playCount;if(this._bg){this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=null);var o=this.getFrameIndex(),a=0,s=0;this._autoPlayTimer=setInterval((function(){o%=e._totalCount;var t=e.toColRow(o);e.setColRow(t[0],t[1]),o++,++s===e._totalCount&&(s=0,a++),r>0&&a===r&&clearInterval(e._autoPlayTimer)}),i)}else this._autoPlayReservedInfo={interval:i,playCount:r}},n.toColRow=function(t){var e=this._colCount,n=this._rowCount;return t<0?[0,0]:t>=this._totalCount?[e-1,n-1]:[t%e,Math.floor(t/e)]},e}(n);return t.VERSION=kt,t}(),En=.21,yn=function(){var t=function(t){function n(n,i){var r;(r=t.call(this)||this)._el=n;var a=o({},i),s=a.colCount||1,u=a.rowCount||1;return r._scale=a.scale||1,r._panScale=r._scale*En,r._frameCount=s*u,r._sprites=new mn(n,a).on({load:function(t){r.trigger("load",t)},imageError:function(t){r.trigger("imageError",{imageUrl:t.imageUrl})}}),r._panInput=new e.PanInput(r._el,{scale:[r._panScale,r._panScale]}),r._axes=new e({angle:{range:[0,359],circular:!0}}).on({change:function(t){var e=Math.floor(t.pos.angle/(360/r._frameCount)),n=r._frameCount-e-1;r._sprites.setFrameIndex(n),r.trigger("change",{frameIndex:n,colRow:r._sprites.getColRow(),angle:t.pos.angle})},animationEnd:function(t){r.trigger("animationEnd",{isTrusted:t.isTrusted})}}),r._axes.connect("angle",r._panInput),r}a(n,t);var i=n.prototype;return i.setScale=function(t){return isNaN(t)||t<0?this:(this._scale=t,this._panScale=t*En,this._panInput.options.scale=[this._panScale,this._panScale],this)},i.getScale=function(){return this._scale},i.spinBy=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setBy({angle:t},e.duration),this},i.spinTo=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setTo({angle:t},e.duration),this},i.getAngle=function(){return this._axes.get().angle||0},n}(n);return t.VERSION=kt,t}();t.PanoViewer=pn,t.SpinViewer=yn,t.SpriteImage=mn,t.VERSION=kt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=view360.min.js.map